generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // â†” Pour SQLite: "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TECH
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String?
  passwordHash String
  role         Role          @default(TECH)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  toolsUpdated ToolHistory[] @relation("UserToolHistory")
  toolsScanned Tool[]        @relation("UserLastScan")

  @@map("users")
}

model Tool {
  id              String        @id @default(cuid())
  hash            String        @unique
  name            String
  description     String?
  status          String?
  location        String?
  operator        String?
  note            String?
  lastScannedAt   DateTime?
  lastScannedById String?
  lastScannedBy   User?         @relation("UserLastScan", fields: [lastScannedById], references: [id])
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  histories       ToolHistory[]

  @@map("tools")
  @@index([name])
}

model ToolHistory {
  id            String   @id @default(cuid())
  toolId        String
  tool          Tool     @relation(fields: [toolId], references: [id])
  performedById String?
  performedBy   User?    @relation("UserToolHistory", fields: [performedById], references: [id])
  changes       Json
  createdAt     DateTime @default(now())

  @@map("tool_history")
  @@index([toolId])
}
